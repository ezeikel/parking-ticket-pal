# Parking Ticket Pal - Mobile App

Expo SDK 55 / React Native 0.83 mobile app for managing and challenging UK parking tickets.

## Tech Stack

- **Framework**: Expo SDK 55, React Native 0.83
- **Navigation**: Expo Router with native iOS tab bar (`NativeTabs`)
- **Styling**: NativeWind v5 (`5.0.0-preview.2`) + Tailwind CSS v4
- **State**: React Query for server state, React context for local state
- **Auth**: Social auth (Apple, Google, Facebook) + magic link email
- **Payments**: RevenueCat (in-app purchases & subscriptions)
- **Analytics**: PostHog
- **Error Tracking**: Sentry
- **Ads**: Google Mobile Ads

## Getting Started

All commands run from `apps/mobile`.

```bash
# Pull environment variables
pnpm env:pull

# Prebuild native projects (required first time or after native dep changes)
pnpm prebuild:ios

# Build and run on iOS simulator
pnpm ios

# Or as a shortcut (prebuild + build)
pnpm build:ios

# Start Metro dev server only (JS changes, no native rebuild)
pnpm dev
```

## Project Structure

```
app/
  _layout.tsx              # Root layout (Sentry, providers, global.css import)
  index.tsx                # Entry redirect (auth check)
  onboarding.tsx           # Onboarding carousel
  auth/
    magic-link/verify.tsx  # Magic link verification
  (authenticated)/
    _layout.tsx            # Auth guard
    (tabs)/
      _layout.tsx          # Tab bar (Tickets, Settings)
      index.tsx            # Tickets list screen
      settings.tsx         # Settings screen
      capture.tsx          # Camera capture
    ticket/[id].tsx        # Ticket detail
    notifications.tsx      # Notifications
components/                # Reusable components
hooks/                     # Custom hooks (API, analytics, etc.)
services/                  # Business logic (purchases, ads)
contexts/                  # React contexts
lib/                       # Utilities (analytics, notifications)
constants/                 # App constants
styles/                    # Shared style objects
```

## Styling with NativeWind v5 + Tailwind CSS v4

### How It Works

NativeWind v5 uses `react-native-css` with a Metro resolver that intercepts `react-native` imports and swaps them for CSS-aware wrapper components. This gives standard RN components automatic `className` support.

### Config Files

| File | Purpose |
|------|---------|
| `global.css` | Tailwind imports + `@theme {}` with custom fonts/colors |
| `metro.config.js` | `withNativeWind(config, { input: './global.css' })` |
| `babel.config.js` | Just `babel-preset-expo` (no NativeWind babel preset in v5) |
| `postcss.config.mjs` | `@tailwindcss/postcss` plugin |
| `nativewind-env.d.ts` | TypeScript types (`react-native-css/types`) |

### Important: `SafeAreaView` Does NOT Support `className`

The `react-native-css` polyfill wraps standard RN components (`View`, `Text`, `ScrollView`, `Pressable`, etc.) with `className` -> `style` mapping. However, **`SafeAreaView` from `react-native-safe-area-context` is NOT wrapped** -- it's re-exported unchanged. Only `SafeAreaProvider` gets a wrapper (for CSS variable injection of inset values).

This means `className` on `SafeAreaView` is **silently ignored**.

```tsx
// BAD - className is silently ignored, flex-1 won't apply
<SafeAreaView className="flex-1 bg-white" edges={['top']}>

// GOOD - use style prop instead
<SafeAreaView style={{ flex: 1, backgroundColor: 'white' }} edges={['top']}>
```

If you add other third-party components, test that `className` works. If the component isn't listed in `node_modules/react-native-css/dist/commonjs/components/`, it won't have `className` support.

### Custom Theme

Fonts and colors are defined in `global.css` via `@theme {}` (Tailwind v4 CSS-based config, no `tailwind.config.ts`):

```css
@import "tailwindcss";
@import "nativewind/theme";

@theme {
  --font-jakarta: "PlusJakartaSans-Regular";
  --color-dark: #222222;
  --color-teal: #1abc9c;
  /* ... */
}
```

## Native Build Rules

- **Never call `pod install` directly** -- `expo prebuild` handles CocoaPods
- **Never modify `ios/` or `android/` manually** -- they are regenerated by prebuild
- Run `pnpm prebuild:ios` when native dependencies change
- JS-only changes just need a Metro restart (`pnpm start --clear`)

## EAS Builds

```bash
pnpm eas:build:preview:ios        # Cloud preview build
pnpm eas:build:preview:android    # Cloud preview build
pnpm eas:build:production         # Cloud production build
```
